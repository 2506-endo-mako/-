<!DOCTYPE html>
<html xmlns:th="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="UTF-8">
    <link th:href="@{/css/style.css}" rel="styleSheet">
    <title>ユーザ管理</title>
</head>
<body>
<div class="header-contents">
    <h2>ユーザ管理</h2>
    <!--エラーメッセージ -->
    <div class="errorMessages" th:each="errorMessage : ${errorMessages}">
        <li><span th:text="${errorMessage}"/></li>
    </div>
    <!--新規ユーザー登録-->
    <a href="/signUp">
        <button class="signUp-button" type="button">新規ユーザー登録</button>
    </a>
    <a th:method="post" action="/manage">
        <div class="main-contents">
            <table class="tasks">
                <tr class="title">
                    <th class="account">アカウント</th>
                    <th class="name">名前</th>
                    <th class="branchName">支店名</th>
                    <th class="departmentName">部署名</th>
                    <th class="isStopped">稼働状態</th>
                </tr>

                <tr class="form-area" th:each="userData : ${userData}">
                    <td class="account">
                        <span th:text="${userData.account}"/>
                    </td>
                    <td class="name">
                        <span th:text="${userData.name}"/>
                    </td>
                    <td class="branchName">
                        <span th:text="${userData.branchName}"/>
                    </td>
                    <td class="departmentName">
                        <span th:text="${userData.departmentName}"/>
                    </td>
                    <td class="isStopped">
                        <form th:if="${userData.id} != ${loginUser.id}"
                              th:action="@{/updateStatus/{id}(id=${userData.id})}" th:method="put">
                            <select name="status">
                                <option value="0" th:selected="${userData.isStopped == 0}"> 稼働</option>
                                <option value="1" th:selected="${userData.isStopped == 1}"> 停止</option>
                            </select>
                            <input class=confirm-action-btn type="submit" value="更新"/>
                        </form>
                        <div th:if="${userData.id} == ${loginUser.id}">
                            <span th:text="${(userData.isStopped ?: 0) == 0 ? '稼働' : '停止'}"></span>
                        </div>
                    </td>

                    <!--編集ボタン-->
                    <td class="user-edit-button">
                        <a th:href="@{/userEdit/{id}(id=${userData.id})}">
                            <input type="submit" value="編集"/>
                        </a>
                    </td>
                </tr>
            </table>
        </div>
    </a>
    <script>
        //★更新ボタンへのダイアログ機能
        // 'confirm-action-btn' クラスを持つすべての要素を取得
        const confirmButtons = document.querySelectorAll('.confirm-action-btn');

        //取得した各ボタンに対してループ処理を行う
        confirmButtons.forEach(button => {
            button.addEventListener("click", function(event) {
                // data-message 属性から確認メッセージを取得
                const message = this.dataset.message || "ステータスを更新してもよろしいですか？"; // デフォルトメッセージも設定

                var result = window.confirm(message);
                    if( result ) {
                        alert("OKがクリックされました");
                    // もしフォーム送信やリンク遷移を続行させたい場合は、ここで event.preventDefault() を書かない
                    // または、alert("OKがクリックされました"); 以外の処理を行う
                    } else {
                        event.preventDefault(); // デフォルトの動作をキャンセル
                        alert("キャンセルがクリックされました");
                    }
            });
        });
    </script>
    <div class="footer-contents">
        <form action="/top">
            <input type="submit" value="戻る"/>
        </form>
    </div>
</div>
</body>
</html>