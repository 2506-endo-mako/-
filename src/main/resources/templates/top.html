<!DOCTYPE html>
<html xmlns:th="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="UTF-8">
    <link th:href="@{/css/style.css}" rel="styleSheet">
    <title>TOP</title>
</head>
<body>
<div class="header-contents">
    <h1>掲示板</h1>
</div>

<!--エラーメッセージ -->
<div class="errorMessages">
    <span th:text="${errorMessages}"/>
</div>
<!--ログアウト-->
<div class="logout-button">
    <a href="/logout">
        <button type="button">ログアウト</button>
    </a>

</div>
<div class="main-contents">
    <!--新規投稿-->
    <a href="/new">
        <button class="new-button" type="button">新規投稿</button>
    </a>

    <!--ユーザ管理-->
    <div th:each="loginUser : ${loginUser}">
        <div th:if="${loginUser.departmentId == 1}">
            <a href="/userManage">
                <button class="userManage-button" type="button">ユーザ管理</button>
            </a>
        </div>
    </div>

    <form th:method="get" action="/top">
        <div class="form-area">
            <!--フォームの要素の見出しを表すタグ(label)-->
            開始日
            <!-- nameがControllerに渡したい情報　valueが初期表示させたい情報 -->
            <input type="date" name="start_date" th:value="${startDate}">
            終了日
            <input type="date" name="end_date" th:value="${endDate}">
            <!--カテゴリー-->
            カテゴリー
            <input type="category" name="category" th:value="${category}">
            <input type="submit" value="絞込">
        </div>
    </form>
    <div class="form-area" th:each="contentData : ${contentData}">
        <div class="title">
            件名 : <span th:text="${contentData.title}"/>
        </div>
        <div class="text">
            <pre>本文 : <span th:text="${contentData.text}"/></pre>
        </div>
        <div class="category">
            カテゴリー : <span th:text="${contentData.category}"/>
        </div>

        <!--usersテーブルのアカウント名と名前-->
        <div class="tasks" th:each="userData : ${userData}">
            <div th:if="${userData.id == contentData.userId}">
                <div class="text">
                    アカウント名 : <span th:text="${userData.account}"/>
                </div>
                <div class="text">
                    名前 : <span th:text="${userData.name}"/>
                </div>
            </div>
        </div>

        <!--削除ボタン-->
        <div class="delete-button">
            <form th:if="${loginUser != null and loginUser.id == contentData.userId}"
                  th:action="@{/delete/{id}(id=${contentData.id})}" th:method="delete">
                <div>
                    <input class="confirm-action-btn" type="submit" value="削除">
                </div>
            </form>
        </div>

        <!--コメント返信投稿-->
        <form method="post" action="/commentAdd" th:object="${formModel}">
            <div class="form-area">
                <div class="errorMessages">
                    <div th:if="${MessageId == contentData.id}">
                        <span th:text="${commentErrorMessage}"/>
                    </div>
                </div>
                <!--textはEntityへと通じてる-->
                <textarea class="comment-box" th:field="*{text}" size="20" maxlength="600"/></textarea></br>
                <input type="hidden" name="messageId" th:value="${contentData.id}"/>
                <input type="submit" value="返信"/>
            </div>
        </form>

        <!--コメント返信表示処理-->
        <div class="message-icon" th:each="commentData : ${commentData}">

            <div th:if="${contentData.id == commentData.messageId}">
                <div class="text">
                    コメント :
                    <pre><span th:text="${commentData.text}"/></pre>
                </div>
                <div class="text">
                    作成日時 : <span th:text="${commentData.createdDate}"/>
                </div>
                <div class="delete-button">
                    <form th:if="${loginUser != null and loginUser.id == commentData.userId}"
                          th:action="@{/commentDelete/{id}(id=${commentData.id})}" th:method="delete">
                        <input class=confirm-action-btn type="submit" value="削除">
                    </form>
                </div>
            </div>
        </div>
        <br/>
        <br/>


        <script>
            //★削除ボタンへのダイアログ機能
            // 'confirm-action-btn' クラスを持つすべての要素を取得
            const confirmButtons = document.querySelectorAll('.confirm-action-btn');

            //取得した各ボタンに対してループ処理を行う
            confirmButtons.forEach(button => {
                button.addEventListener("click", function(event) {
                    // data-message 属性から確認メッセージを取得
                    const message = this.dataset.message || "削除してもよろしいですか？"; // デフォルトメッセージも設定

                    var result = window.confirm(message);
                        if( result ) {
                            alert("OKがクリックされました");
                        // もしフォーム送信やリンク遷移を続行させたい場合は、ここで event.preventDefault() を書かない
                        // または、alert("OKがクリックされました"); 以外の処理を行う
                        } else {
                            event.preventDefault(); // デフォルトの動作をキャンセル
                            alert("キャンセルがクリックされました");
                        }
                });
            });
        </script>
    </div>
</div>
</body>
</html>